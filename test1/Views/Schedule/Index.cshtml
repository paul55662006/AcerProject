@{
    ViewData["Title"] = "寵物醫院 - 排班";
}

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>

    <!-- Tui.Calendar CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.css">
</head>
<body>
    <div class="container">
        <h1>@ViewData["Title"]</h1>

        <!-- 篩選器區域 -->
        <div class="filters">
            <label for="yearSelector">年份：</label>
            <select id="yearSelector">
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
            </select>

            <label for="monthSelector">月份：</label>
            <select id="monthSelector">
                <option value="0">1 月</option>
                <option value="1" selected>2 月</option>
                <option value="2">3 月</option>
                <!-- 其他月份 -->
            </select>

            <label for="categorySelector">寵物類別：</label>
            <select id="categorySelector">
                <option value="all" selected>全部</option>
                <option value="dog">狗</option>
                <option value="cat">貓</option>
            </select>
        </div>

        <div id="calendar"></div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.min.js"></script>

    <!-- Tui.Calendar JavaScript -->
    <script src="https://uicdn.toast.com/calendar/latest/tui-calendar.js"></script>

    @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                try {
                    // 初始化 Tui.Calendar
                    const calendar = new tui.Calendar('#calendar', {
                        defaultView: 'month', // 預設月視圖
                        useDetailPopup: true, // 啟用詳細訊息彈窗
                        useCreationPopup: true, // 啟用新增事件彈窗
                    });

                    // 測試事件資料
                    const schedules = [
                        {
                            id: '1',
                            calendarId: '1',
                            title: '診療事件 1',
                            category: 'time',
                            start: '2025-01-03T10:00:00',
                            end: '2025-01-03T12:00:00',
                            petType: 'dog',
                        },
                        {
                            id: '2',
                            calendarId: '1',
                            title: '診療事件 2',
                            category: 'time',
                            start: '2025-01-04T14:00:00',
                            end: '2025-01-04T16:00:00',
                            petType: 'cat',
                        },
                    ];

                    calendar.createSchedules(schedules);

                    // 年/月選擇器事件
                    document.getElementById('yearSelector').addEventListener('change', updateCalendarDate);
                    document.getElementById('monthSelector').addEventListener('change', updateCalendarDate);

                    // 寵物類別選擇器事件
                    document.getElementById('categorySelector').addEventListener('change', function () {
                        const selectedCategory = this.value;

                        const filteredSchedules = schedules.filter(schedule => {
                            return selectedCategory === 'all' || schedule.petType === selectedCategory;
                        });

                        calendar.clear();
                        calendar.createSchedules(filteredSchedules);
                    });

                    // 更新日曆日期
                    function updateCalendarDate() {
                        const year = document.getElementById('yearSelector').value;
                        const month = document.getElementById('monthSelector').value;

                        const newDate = new Date(year, month);
                        calendar.setDate(newDate); // 更新日曆到選擇的年月
                    }
                } catch (e) {
                    console.error('初始化 Tui.Calendar 時出現錯誤：', e);
                }
            });
        </script>
    }
</body>
</html>
